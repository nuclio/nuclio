
<!DOCTYPE html>

<html lang="go">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Developing with Minikube &#8212; nuclio 1.12.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="developing-with-minikube">
<h1>Developing with Minikube<a class="headerlink" href="#developing-with-minikube" title="Permalink to this heading">¶</a></h1>
<p>This guide will guide you through the process of deploying and running your locally built Nuclio sources on a local Kubernetes cluster in your Minikube VM. This is helpful when you're developing new functionality in the Kubernetes platform and need to test it against a real Kubernetes cluster.</p>
<section id="working-assumptions">
<h2>Working assumptions<a class="headerlink" href="#working-assumptions" title="Permalink to this heading">¶</a></h2>
<p>This guide assumes that:</p>
<ul class="simple">
<li><p>You set up your Minikube VM as described in the <a class="reference internal" href="../../setup/minikube/getting-started-minikube.html"><span class="doc std std-doc">Minikube getting started guide</span></a></p></li>
<li><p>You have previously deployed a <em>released</em> Nuclio version on top of it and interacted with it</p></li>
<li><p>You have a working Nuclio development environment, and you're on a branch containing changes you made which pertain to the Kubernetes platform</p></li>
</ul>
</section>
<section id="get-your-local-images-onto-minikube">
<h2>Get your local images onto Minikube<a class="headerlink" href="#get-your-local-images-onto-minikube" title="Permalink to this heading">¶</a></h2>
<p>When you install Nuclio's services onto Minikube (using the <span class="xref myst">Helm chart</span>), Kubernetes examines the given resource specification to determine which images to use for Nuclio's controller and dashboard services. To get it to take your images, we must first push them onto the local Docker registry running inside the Minikube VM. To do this:</p>
<ul class="simple">
<li><p>Make sure you've built container images with your changes (<code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">build</span></code>)</p></li>
<li><p>Push them by running the script located at <code class="docutils literal notranslate"><span class="pre">hack/scripts/minikube/push_images.py</span></code>. Keep in mind the script assumes the local Docker registry to be listening on port 5000 of the Minikube VM. It does the following:</p>
<ul>
<li><p>Iterates over the existing Nuclio container images on the host machine</p></li>
<li><p>For each such image:</p>
<ul>
<li><p>Tags it locally as <code class="docutils literal notranslate"><span class="pre">$(minikube</span> <span class="pre">ip):5000/&lt;image&gt;</span></code> (i.e., <code class="docutils literal notranslate"><span class="pre">192.168.64.4:5000/processor:latest-amd64</span></code>)</p></li>
<li><p>Pushes it to the Docker registry. Since the image's tag refers to a registry, it's pushed to the Minikube registry.</p></li>
<li><p>Untags it locally</p></li>
<li><p><em>(in the Minikube VM)</em> Pulls the image, specifying the local Docker registry (i.e., <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span> <span class="pre">localhost:5000/processor:latest-amd64</span></code>)</p></li>
<li><p><em>(in the Minikube VM)</em> Tags it with the <code class="docutils literal notranslate"><span class="pre">nuclio/</span></code> prefix (i.e., <code class="docutils literal notranslate"><span class="pre">nuclio/processor:latest-amd64</span></code>)</p></li>
<li><p><em>(in the Minikube VM)</em> Untags the Minikube-specific tag</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This will make the latest versions of our locally-built images available from the Docker registry in the Minikube VM.</p>
</section>
<section id="deploy-a-custom-version-of-the-nuclio-services">
<h2>Deploy a custom version of the Nuclio services<a class="headerlink" href="#deploy-a-custom-version-of-the-nuclio-services" title="Permalink to this heading">¶</a></h2>
<p>The usual <span class="xref myst">Nuclio Helm chart</span> always points to controller and dashboard images fixed to some version,
but in our case, we must use a modified version.
From the project root run the following:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>helm<span class="w"> </span>install<span class="w"> </span>nuclio<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>registry.pushPullUrl<span class="o">=</span>localhost:5000<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>controller.image.tag<span class="o">=</span>latest-amd64<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>dashboard.image.tag<span class="o">=</span>latest-amd64<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--set<span class="w"> </span>dashboard.baseImagePullPolicy<span class="o">=</span>Never<span class="w"> </span><span class="se">\</span>
<span class="w">	</span>./hack/k8s/helm/nuclio/
</pre></div>
</div>
<p>It differs from the usual upstream chart in that:</p>
<ol class="arabic simple">
<li><p>Controller/dashboard images are &quot;latest&quot;, resulting in the images you pushed in the last step being used</p></li>
<li><p>Controller/dashboard images are never pulled from Docker Hub</p></li>
<li><p>Dashboard is told (via an environment variable) not to pull base images when deploying functions (it'll use the images you pushed)</p></li>
<li><p>It uses the helm chart from a local copy - giving you additional ability to test any local changes to the nuclio chart</p></li>
</ol>
<p>You should now have a functional Kubernetes cluster using images built from your local changes, and can test against it to make sure they work as expected. Keep in mind when using a locally-built latest <code class="docutils literal notranslate"><span class="pre">nuctl</span></code>, to specify <code class="docutils literal notranslate"><span class="pre">--no-pull</span></code> such that the base images you pushed are used.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">nuclio</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../concepts/architecture.html">Architecture</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, nuclio.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/devel/minikube/developing-on-minikube.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>