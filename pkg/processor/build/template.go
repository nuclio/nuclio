package build

var dockerfileTemplateText = `
# Generated by nuctl

FROM {{.Image}}

{{$optDir := .OptDir}}

RUN mkdir -p {{$optDir}}

{{range .Copy}}
{{ if . | IsDir}}
COPY {{.}} {{$optDir}}/{{. | Basename}}
{{else}}
COPY {{.}} {{$optDir}}
{{end}}
{{end}}

{{if .Script}}
COPY {{.Script}} /
RUN /{{.Script | Basename}}
RUN rm /{{.Script | Basename}}
{{end}}

{{if .Commands}}
{{range .Commands}}
RUN {{.}}
{{end}}
{{end}}

COPY processor /usr/local/bin

{{$etcDir := .EtcDir}}

RUN mkdir -p {{$etcDir}}
{{range .ConfigFiles}}
COPY {{.}} {{$etcDir}}
{{end}}

CMD [ "processor", "--config", "{{$etcDir}}/processor.yaml" ]
`
